<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Create Pool Authentication</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .button { 
            background: #3b82f6; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        .button:hover { background: #2563eb; }
        .output { 
            background: #f3f4f6; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0; 
            white-space: pre-wrap;
        }
        .success { background: #d1fae5; border-left: 4px solid #10b981; }
        .error { background: #fee2e2; border-left: 4px solid #ef4444; }
    </style>
</head>
<body>
    <h1>üîß Test Create Pool Authentication</h1>
    
    <div>
        <button class="button" onclick="createTestLender()">Create Test Lender User</button>
        <button class="button" onclick="checkAuthState()">Check Auth State</button>
        <button class="button" onclick="testCreatePoolAccess()">Test Create Pool Access</button>
        <button class="button" onclick="clearAllData()">Clear All Data</button>
    </div>

    <div id="output" class="output">Ready to test...</div>

    <script>
        function createTestLender() {
            const testUser = {
                id: 'test-lender-' + Date.now(),
                firstName: 'Test',
                lastName: 'Lender',
                email: 'lender@test.com',
                userType: 'lender',
                kycStatus: 'approved',
                isEmailVerified: true,
                creditScore: 750,
                phone: '+1234567890',
                createdAt: new Date().toISOString()
            };

            const testToken = 'test-access-token-' + Date.now();
            const testRefreshToken = 'test-refresh-token-' + Date.now();

            localStorage.setItem('accessToken', testToken);
            localStorage.setItem('refreshToken', testRefreshToken);
            localStorage.setItem('user', JSON.stringify(testUser));

            showOutput('‚úÖ Test lender user created successfully!', 'success');
            showOutput(`User: ${testUser.firstName} ${testUser.lastName} (${testUser.userType})`, 'success');
            showOutput(`Email: ${testUser.email}`, 'success');
            showOutput(`Token: ${testToken}`, 'success');
        }

        function checkAuthState() {
            const token = localStorage.getItem('accessToken');
            const user = localStorage.getItem('user');
            const refreshToken = localStorage.getItem('refreshToken');

            let output = 'üîç Current Authentication State:\n\n';
            output += `Access Token: ${token ? '‚úÖ Present' : '‚ùå Missing'}\n`;
            output += `Refresh Token: ${refreshToken ? '‚úÖ Present' : '‚ùå Missing'}\n`;
            output += `User Data: ${user ? '‚úÖ Present' : '‚ùå Missing'}\n\n`;

            if (user) {
                try {
                    const userData = JSON.parse(user);
                    output += `User Details:\n`;
                    output += `- Name: ${userData.firstName} ${userData.lastName}\n`;
                    output += `- Email: ${userData.email}\n`;
                    output += `- User Type: ${userData.userType}\n`;
                    output += `- KYC Status: ${userData.kycStatus}\n`;
                    output += `- Credit Score: ${userData.creditScore}\n`;
                } catch (e) {
                    output += `‚ùå Error parsing user data: ${e.message}\n`;
                }
            }

            showOutput(output, user ? 'success' : 'error');
        }

        function testCreatePoolAccess() {
            const token = localStorage.getItem('accessToken');
            const user = localStorage.getItem('user');

            if (!token || !user) {
                showOutput('‚ùå No authentication data found. Please create a test user first.', 'error');
                return;
            }

            try {
                const userData = JSON.parse(user);
                
                if (userData.userType !== 'lender') {
                    showOutput(`‚ùå User type is '${userData.userType}', but 'lender' is required for creating pools.`, 'error');
                    return;
                }

                showOutput('‚úÖ Authentication data looks good!', 'success');
                showOutput('üöÄ You can now try accessing the Create Pool page.', 'success');
                showOutput('üìù Go to: http://localhost:5173/marketplace/create-pool', 'success');
                
                // Auto-redirect after 2 seconds
                setTimeout(() => {
                    window.open('http://localhost:5173/marketplace/create-pool', '_blank');
                }, 2000);
                
            } catch (e) {
                showOutput(`‚ùå Error parsing user data: ${e.message}`, 'error');
            }
        }

        function clearAllData() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('user');
            showOutput('üóëÔ∏è All authentication data cleared.', 'success');
        }

        function showOutput(message, type = '') {
            const output = document.getElementById('output');
            output.textContent = message;
            output.className = `output ${type}`;
        }

        // Check initial state
        checkAuthState();
    </script>
</body>
</html>

